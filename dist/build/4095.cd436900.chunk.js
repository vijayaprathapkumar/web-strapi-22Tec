"use strict";(self.webpackChunkmy_project=self.webpackChunkmy_project||[]).push([[4095],{94095:(cs,J,s)=>{s.d(J,{ReviewWorkflowsEditPage:()=>ls});var t=s(74081),_=s(27279),G=s(48102),C=s(10701),X=s(77970),A=s(32370),M=s(15530),$=s(59082),T=s(71563),b=s(61020),l=s(59461),q=s(51447),ss=s(51950),ts=s(5769),e=s(23441),os=s(13067),es=s(43639),ns=s(88108),as=s(46413),h=s(64462),E=s(41186),I=s(47289),is=s(58661),Ls=s(8217),Cs=s(6078),As=s(43433),Ts=s(47853),Is=s(64797),Rs=s(85811),Ws=s(98934),Bs=s(8175),Us=s(15816),Ks=s(97442),ys=s(13576),us=s(87830),ws=s(47184),js=s(364),ps=s(49204),Ss=s(74919),xs=s(29206),Fs=s(40464),ks=s(75719),Ns=s(51943),Zs=s(55783),zs=s(92249),Vs=s(41942),Ys=s(22919),Hs=s(53915),Qs=s(75041),Js=s(30200),Gs=s(91379),Xs=s(33299),$s=s(33409),bs=s(63645),qs=s(7988),st=s(7055),tt=s(26757),ot=s(58311),et=s(24840),nt=s(29510),at=s(16946),it=s(10124),lt=s(69530),_t=s(86961),rt=s(51527),Et=s(19764),dt=s(42982),Mt=s(26126);const ls=()=>{const{workflowId:j}=(0,q.UO)(),_s=(0,l.v9)(os.s),{formatMessage:n}=(0,b.Z)(),r=(0,l.I0)(),{_unstableFormatAPIError:rs,_unstableFormatValidationErrors:Es}=(0,M.So)(),D=(0,M.lm)(),{isLoading:P,meta:O,workflows:g}=(0,is.u)(),{collectionTypes:p,singleTypes:S,isLoading:R}=(0,ts.u)(),ds=(0,l.v9)(e.j),Ms=(0,l.v9)(e.a),a=(0,l.v9)(e.b),x=(0,l.v9)(e.k),F=(0,l.v9)(e.c),v=(0,l.v9)(e.s),{allowedActions:{canDelete:Ds,canUpdate:W}}=(0,M.ss)(_s.settings?.["review-workflows"]),[c,L]=_.useState({}),{getFeature:Ps,isLoading:k}=(0,ns.u)(),{isLoading:B,roles:N}=(0,ss.u)(void 0),[Z,d]=_.useState(null),[Os,z]=_.useState(),[gs,V]=_.useState(!1),U=g?.find(o=>o.id===parseInt(j,10)),Y=g?.filter(o=>o.id!==parseInt(j,10)).flatMap(o=>o.contentTypes),K=Ps("review-workflows"),f=K?.[I.C],m=K?.[I.a],[vs]=(0,as.e)(),H=async()=>{z(void 0),V(!0);try{const o=await vs({...a,stages:a.stages?.map(i=>{let Q=!0;const u=ds.workflow?.stages?.find(w=>w.id===i?.id);return u&&(Q=u.permissions?.length!==i.permissions?.length||!u.permissions?.every(w=>!!i.permissions?.find(hs=>hs.role===w.role))),{...i,permissions:Q?i.permissions:void 0}})});if("error"in o){(0,es.x)(o.error)&&o.error.name==="ValidationError"?z(Es(o.error)):D({type:"warning",message:rs(o.error)});return}D({type:"success",message:{id:"notification.success.saved",defaultMessage:"Saved"}})}catch{D({type:"warning",message:{id:"notification.error",defaultMessage:"An error occurred"}})}finally{V(!1)}L({})},fs=async()=>{await H()},ms=()=>{L({})},y=(0,T.TA)({enableReinitialize:!0,initialErrors:Os,initialValues:a,async onSubmit(){const o=a.contentTypes?.some(i=>Y?.includes(i));O&&f&&O?.workflowCount>parseInt(f,10)?d("workflow"):a.stages&&m&&a.stages.length>parseInt(m,10)?d("stage"):x||o?(x&&L(i=>({...i,hasDeletedServerStages:!0})),o&&L(i=>({...i,hasReassignedContentTypes:!0}))):H()},validate(o){return(0,e.v)({values:o,formatMessage:n})}});return(0,e.u)(I.R,e.i),_.useEffect(()=>(!P&&U&&g&&(r((0,e.l)({workflow:U})),r((0,e.d)({workflows:g}))),R||r((0,e.e)({collectionTypes:p,singleTypes:S})),B||r((0,e.f)(N)),r((0,e.g)(P||R||B)),()=>{r((0,e.r)())}),[p,r,R,P,B,N,S,U,g]),_.useEffect(()=>{!P&&!k&&(O&&f&&O?.workflowCount>parseInt(f,10)?d("workflow"):a.stages&&m&&a.stages.length>parseInt(m,10)&&d("stage"))},[a.stages,k,P,K,O,f,m]),_.useEffect(()=>{!v&&F?.length===0&&D({blockTransition:!0,type:"warning",message:n({id:"Settings.review-workflows.stage.permissions.noPermissions.description",defaultMessage:"You don\u2019t have the permission to see roles"})})},[n,v,F,D]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(h.D,{}),(0,t.jsx)(T.Hy,{value:y,children:(0,t.jsxs)(T.l0,{onSubmit:y.handleSubmit,children:[(0,t.jsx)(h.H,{navigationAction:(0,t.jsx)(h.B,{href:"/settings/review-workflows"}),primaryAction:W&&(0,t.jsx)(G.z,{startIcon:(0,t.jsx)($.Z,{}),type:"submit",size:"M",disabled:!Ms,loading:!Boolean(Object.keys(c).length>0)&&gs,children:n({id:"global.save",defaultMessage:"Save"})}),subtitle:!v&&n({id:"Settings.review-workflows.page.subtitle",defaultMessage:"{count, plural, one {# stage} other {# stages}}"},{count:a.stages?.length}),title:a.name||""}),(0,t.jsx)(h.R,{children:v?(0,t.jsx)(C.k,{justifyContent:"center",children:(0,t.jsx)(X.a,{children:n({id:"Settings.review-workflows.page.isLoading",defaultMessage:"Workflow is loading"})})}):(0,t.jsxs)(C.k,{alignItems:"stretch",direction:"column",gap:7,children:[(0,t.jsx)(e.W,{canUpdate:W}),(0,t.jsx)(e.S,{canDelete:Ds,canUpdate:W,stages:y.values?.stages})]})})]})}),(0,t.jsx)(M.QH.Root,{isConfirmButtonLoading:v,isOpen:Object.keys(c).length>0,onToggleDialog:ms,onConfirm:fs,children:(0,t.jsx)(M.QH.Body,{children:(0,t.jsxs)(C.k,{direction:"column",gap:5,children:[c.hasDeletedServerStages&&(0,t.jsx)(A.Z,{textAlign:"center",variant:"omega",children:n({id:"Settings.review-workflows.page.delete.confirm.stages.body",defaultMessage:"All entries assigned to deleted stages will be moved to the previous stage."})}),c.hasReassignedContentTypes&&(0,t.jsx)(A.Z,{textAlign:"center",variant:"omega",children:n({id:"Settings.review-workflows.page.delete.confirm.contentType.body",defaultMessage:"{count} {count, plural, one {content-type} other {content-types}} {count, plural, one {is} other {are}} already mapped to {count, plural, one {another workflow} other {other workflows}}. If you save changes, {count, plural, one {this} other {these}} {count, plural, one {content-type} other {{count} content-types}} will no more be mapped to the {count, plural, one {another workflow} other {other workflows}} and all corresponding information will be removed."},{count:Y?.filter(o=>a.contentTypes?.includes(o)).length})}),(0,t.jsx)(A.Z,{textAlign:"center",variant:"omega",children:n({id:"Settings.review-workflows.page.delete.confirm.confirm",defaultMessage:"Are you sure you want to save?"})})]})})}),(0,t.jsxs)(E.L.Root,{isOpen:Z==="workflow",onClose:()=>d(null),children:[(0,t.jsx)(E.L.Title,{children:n({id:"Settings.review-workflows.edit.page.workflows.limit.title",defaultMessage:"You\u2019ve reached the limit of workflows in your plan"})}),(0,t.jsx)(E.L.Body,{children:n({id:"Settings.review-workflows.edit.page.workflows.limit.body",defaultMessage:"Delete a workflow or contact Sales to enable more workflows."})})]}),(0,t.jsxs)(E.L.Root,{isOpen:Z==="stage",onClose:()=>d(null),children:[(0,t.jsx)(E.L.Title,{children:n({id:"Settings.review-workflows.edit.page.stages.limit.title",defaultMessage:"You have reached the limit of stages for this workflow in your plan"})}),(0,t.jsx)(E.L.Body,{children:n({id:"Settings.review-workflows.edit.page.stages.limit.body",defaultMessage:"Try deleting some stages or contact Sales to enable more stages."})})]})]})}}}]);
